<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>„Ç§„É≥„Çø„É©„ÇØ„ÉÜ„Ç£„Éñ„Ç¨„É≥„Éà„ÉÅ„É£„Éº„Éà - D3-Mind-Flow-Editor</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        * {
            box-sizing: border-box;
        }

        body {
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', 'Hiragino Sans', 'Yu Gothic UI', system-ui, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            overflow: hidden;
        }

        .container {
            width: 100vw;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            padding: 15px 20px;
            border-bottom: 1px solid #e0e0e0;
            backdrop-filter: blur(10px);
        }

        .header h2 {
            margin: 0 0 10px 0;
            color: #333;
            font-size: 18px;
        }

        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            align-items: center;
        }

        .controls button, .controls select {
            padding: 8px 15px;
            border: none;
            border-radius: 6px;
            background: #4CAF50;
            color: white;
            cursor: pointer;
            font-size: 12px;
            font-weight: 500;
            transition: all 0.2s ease;
        }

        .controls button:hover {
            background: #45a049;
            transform: translateY(-1px);
        }

        .controls select {
            background: white;
            color: #333;
            border: 1px solid #ddd;
        }

        .gantt-container {
            flex: 1;
            overflow: auto;
            background: white;
        }

        .gantt-svg {
            border: none;
            background: white;
        }

        .task-bar {
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .task-bar:hover {
            stroke: #333;
            stroke-width: 2;
            filter: brightness(0.9);
        }

        .task-bar.completed {
            fill: #4CAF50;
        }

        .task-bar.in-progress {
            fill: #2196F3;
        }

        .task-bar.delayed {
            fill: #F44336;
        }

        .task-bar.not-started {
            fill: #FFC107;
        }

        .progress-bar {
            pointer-events: none;
            opacity: 0.8;
        }

        .progress-bar.completed {
            fill: #2E7D32;
        }

        .progress-bar.in-progress {
            fill: #1565C0;
        }

        .task-label {
            font-size: 11px;
            font-weight: 500;
            fill: #333;
            pointer-events: none;
        }

        .axis {
            font-size: 10px;
        }

        .axis path,
        .axis line {
            fill: none;
            stroke: #999;
            shape-rendering: crispEdges;
        }

        .axis text {
            font-family: inherit;
        }

        .grid line {
            stroke: #e0e0e0;
            stroke-dasharray: 2,2;
            shape-rendering: crispEdges;
        }

        .dependency {
            fill: none;
            stroke: #ff6b6b;
            stroke-width: 2;
            marker-end: url(#arrowhead);
            opacity: 0.7;
        }

        .dependency:hover {
            opacity: 1;
            stroke-width: 3;
        }

        .tooltip {
            position: absolute;
            padding: 12px;
            background: rgba(0, 0, 0, 0.9);
            color: white;
            border-radius: 6px;
            pointer-events: none;
            font-size: 12px;
            z-index: 1000;
            max-width: 300px;
            backdrop-filter: blur(5px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }

        .stats {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.95);
            padding: 15px;
            border-radius: 10px;
            font-size: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
            backdrop-filter: blur(10px);
            min-width: 220px;
            z-index: 999;
        }

        .stats h4 {
            margin: 0 0 10px 0;
            color: #333;
            font-size: 14px;
        }

        .stats div {
            margin: 5px 0;
            color: #666;
        }

        .legend {
            display: flex;
            gap: 15px;
            margin-top: 10px;
            flex-wrap: wrap;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 11px;
        }

        .legend-color {
            width: 12px;
            height: 12px;
            border-radius: 2px;
        }

        .milestone {
            fill: #FF5722;
            stroke: #BF360C;
            stroke-width: 2;
        }

        .today-line {
            stroke: #E91E63;
            stroke-width: 2;
            stroke-dasharray: 5,5;
        }

        .progress-text {
            font-size: 9px;
            font-weight: bold;
            fill: white;
            text-anchor: middle;
            pointer-events: none;
        }

        /* Responsive design */
        @media (max-width: 768px) {
            .header {
                padding: 10px;
            }
            
            .controls {
                gap: 5px;
            }
            
            .controls button, .controls select {
                padding: 6px 10px;
                font-size: 11px;
            }
            
            .stats {
                bottom: 10px;
                right: 10px;
                left: 10px;
                font-size: 11px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h2>üìÖ „Ç§„É≥„Çø„É©„ÇØ„ÉÜ„Ç£„Éñ„Ç¨„É≥„Éà„ÉÅ„É£„Éº„Éà</h2>
            <div class="controls">
                <button onclick="fitToView()" title="ÂÖ®‰Ωì„ÇíË°®Á§∫">üéØ ÂÖ®‰ΩìË°®Á§∫</button>
                <button onclick="zoomToToday()" title="‰ªäÊó•„ÅÆ‰ΩçÁΩÆ„Å´„Ç∫„Éº„É†">üìç ‰ªäÊó•</button>
                <select id="timeScale" onchange="changeTimeScale()" title="ÊôÇÈñìËª∏„ÅÆÂçò‰Ωç„ÇíÈÅ∏Êäû">
                    <option value="day">Êó•Âçò‰Ωç</option>
                    <option value="week" selected>ÈÄ±Âçò‰Ωç</option>
                    <option value="month">ÊúàÂçò‰Ωç</option>
                </select>
                <button onclick="toggleDependencies()" title="‰æùÂ≠òÈñ¢‰øÇ„ÅÆË°®Á§∫„ÇíÂàá„ÇäÊõø„Åà">üîó ‰æùÂ≠òÈñ¢‰øÇ</button>
                <button onclick="showCriticalPath()" title="„ÇØ„É™„ÉÜ„Ç£„Ç´„É´„Éë„Çπ„Çí„Éè„Ç§„É©„Ç§„Éà">‚ö° „ÇØ„É™„ÉÜ„Ç£„Ç´„É´</button>
                <button onclick="exportChart()" title="SVG„Å®„Åó„Å¶„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ">üíæ SVGÂá∫Âäõ</button>
                <button onclick="showStatistics()" title="Ë©≥Á¥∞Áµ±Ë®à„ÇíË°®Á§∫">üìä Áµ±Ë®àË©≥Á¥∞</button>
            </div>
            
            <div class="legend">
                <div class="legend-item">
                    <div class="legend-color" style="background: #4CAF50;"></div>
                    <span>ÂÆå‰∫ÜÊ∏à„Åø</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #2196F3;"></div>
                    <span>ÈÄ≤Ë°å‰∏≠</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #FFC107;"></div>
                    <span>Êú™ÈñãÂßã</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #F44336;"></div>
                    <span>ÈÅÖÂª∂</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #FF5722;"></div>
                    <span>„Éû„Ç§„É´„Çπ„Éà„Éº„É≥</span>
                </div>
            </div>
        </div>

        <div class="gantt-container">
            <svg class="gantt-svg" id="gantt"></svg>
        </div>

        <div class="stats">
            <h4>üìä „Éó„É≠„Ç∏„Çß„ÇØ„ÉàÁµ±Ë®à</h4>
            <div>Á∑è„Çø„Çπ„ÇØÊï∞: <span id="totalTasks">0</span></div>
            <div>ÂÆå‰∫Ü„Çø„Çπ„ÇØ: <span id="completedTasks">0</span></div>
            <div>ÈÄ≤Ë°å‰∏≠„Çø„Çπ„ÇØ: <span id="inProgressTasks">0</span></div>
            <div>ÈÅÖÂª∂„Çø„Çπ„ÇØ: <span id="delayedTasks">0</span></div>
            <div>ÂÖ®‰ΩìÈÄ≤Êçó: <span id="overallProgress">0%</span></div>
            <div>„Éó„É≠„Ç∏„Çß„ÇØ„ÉàÊúüÈñì: <span id="projectDuration">0Êó•</span></div>
            <div>ÁèæÂú®„ÅÆË°®Á§∫: <span id="currentView">ÈÄ±Âçò‰Ωç</span></div>
            <div>‰æùÂ≠òÈñ¢‰øÇ: <span id="dependencyStatus">Ë°®Á§∫</span></div>
        </div>

        <div class="tooltip" id="tooltip" style="display: none;"></div>
    </div>

    <script>
        // „Éá„Éº„Çø„Éó„É¨„Éº„Çπ„Éõ„É´„ÉÄ„ÉºÔºàÂÆüÈöõ„ÅÆ„Éá„Éº„Çø„Å´ÁΩÆ„ÅçÊèõ„Åà„Çâ„Çå„Åæ„ÅôÔºâ
        let ganttData = {{DIAGRAM_DATA}};
        
        // „Éá„Éº„Çø„ÅåÁÑ°„ÅÑÂ†¥Âêà„ÅÆ„Çµ„É≥„Éó„É´„Éá„Éº„Çø
        if (!ganttData || !ganttData.content) {
            const today = new Date();
            const formatDate = d => d.toISOString().split('T')[0];
            
            ganttData = [
                {
                    task: "„Éó„É≠„Ç∏„Çß„ÇØ„ÉàË®àÁîª",
                    start: formatDate(new Date(today.getTime() - 14 * 24 * 60 * 60 * 1000)),
                    end: formatDate(new Date(today.getTime() - 7 * 24 * 60 * 60 * 1000)),
                    progress: 100,
                    category: "Ë®àÁîª",
                    resource: "„Éó„É≠„Ç∏„Çß„ÇØ„Éà„Éû„Éç„Éº„Ç∏„É£„Éº",
                    dependencies: ""
                },
                {
                    task: "Ë¶Å‰ª∂ÂÆöÁæ©",
                    start: formatDate(new Date(today.getTime() - 6 * 24 * 60 * 60 * 1000)),
                    end: formatDate(new Date(today.getTime() + 7 * 24 * 60 * 60 * 1000)),
                    progress: 80,
                    category: "ÂàÜÊûê",
                    resource: "„Éì„Ç∏„Éç„Çπ„Ç¢„Éä„É™„Çπ„Éà",
                    dependencies: "„Éó„É≠„Ç∏„Çß„ÇØ„ÉàË®àÁîª"
                },
                {
                    task: "„Ç∑„Çπ„ÉÜ„É†Ë®≠Ë®à",
                    start: formatDate(new Date(today.getTime() + 8 * 24 * 60 * 60 * 1000)),
                    end: formatDate(new Date(today.getTime() + 21 * 24 * 60 * 60 * 1000)),
                    progress: 30,
                    category: "Ë®≠Ë®à",
                    resource: "„Ç∑„Çπ„ÉÜ„É†„Ç¢„Éº„Ç≠„ÉÜ„ÇØ„Éà",
                    dependencies: "Ë¶Å‰ª∂ÂÆöÁæ©"
                },
                {
                    task: "ÈñãÁô∫„Éï„Çß„Éº„Ç∫1",
                    start: formatDate(new Date(today.getTime() + 22 * 24 * 60 * 60 * 1000)),
                    end: formatDate(new Date(today.getTime() + 50 * 24 * 60 * 60 * 1000)),
                    progress: 0,
                    category: "ÈñãÁô∫",
                    resource: "ÈñãÁô∫„ÉÅ„Éº„É†",
                    dependencies: "„Ç∑„Çπ„ÉÜ„É†Ë®≠Ë®à"
                },
                {
                    task: "„ÉÜ„Çπ„Éà„Éï„Çß„Éº„Ç∫",
                    start: formatDate(new Date(today.getTime() + 45 * 24 * 60 * 60 * 1000)),
                    end: formatDate(new Date(today.getTime() + 65 * 24 * 60 * 60 * 1000)),
                    progress: 0,
                    category: "„ÉÜ„Çπ„Éà",
                    resource: "QA„ÉÅ„Éº„É†",
                    dependencies: "ÈñãÁô∫„Éï„Çß„Éº„Ç∫1"
                }
            ];
        }

        // Ë®≠ÂÆö„Å®„Ç∞„É≠„Éº„Éê„É´Â§âÊï∞
        const margin = {top: 50, right: 50, bottom: 80, left: 200};
        const containerWidth = Math.max(1200, window.innerWidth - 40);
        const containerHeight = Math.max(600, Math.max(400, ganttData.length * 60 + 200));
        const width = containerWidth - margin.left - margin.right;
        const height = containerHeight - margin.top - margin.bottom;

        let currentTimeScale = 'week';
        let showDependencies = true;
        let selectedTask = null;

        // SVG‰ΩúÊàê
        const svg = d3.select("#gantt")
            .attr("width", containerWidth)
            .attr("height", containerHeight);

        // „É°„Ç§„É≥„Ç∞„É´„Éº„Éó
        const g = svg.append("g")
            .attr("transform", `translate(${margin.left},${margin.top})`);

        // „ÉÑ„Éº„É´„ÉÅ„ÉÉ„Éó
        const tooltip = d3.select("#tooltip");

        // „Éá„Éº„ÇøÂá¶ÁêÜ
        ganttData.forEach(d => {
            d.startDate = new Date(d.start);
            d.endDate = new Date(d.end);
            d.duration = (d.endDate - d.startDate) / (1000 * 60 * 60 * 24);
            d.progress = parseFloat(d.progress) || 0;
        });

        // „Çπ„Ç±„Éº„É´Ë®≠ÂÆö
        const timeExtent = d3.extent(ganttData.flatMap(d => [d.startDate, d.endDate]));
        const xScale = d3.scaleTime()
            .domain(timeExtent)
            .range([0, width]);

        const yScale = d3.scaleBand()
            .domain(ganttData.map(d => d.task))
            .range([0, height])
            .padding(0.2);

        // „Ç´„ÉÜ„Ç¥„É™Ëâ≤„Éû„ÉÉ„Éî„É≥„Ç∞
        const categoryColors = {
            'Ë®àÁîª': '#9C27B0',
            'ÂàÜÊûê': '#2196F3', 
            'Ë®≠Ë®à': '#FF9800',
            'ÈñãÁô∫': '#4CAF50',
            '„ÉÜ„Çπ„Éà': '#F44336',
            '„Éá„Éó„É≠„Ç§': '#00BCD4'
        };

        // Áü¢Âç∞„Éû„Éº„Ç´„ÉºÂÆöÁæ©
        svg.append("defs").append("marker")
            .attr("id", "arrowhead")
            .attr("viewBox", "-0 -5 10 10")
            .attr("refX", 8)
            .attr("refY", 0)
            .attr("orient", "auto")
            .attr("markerWidth", 6)
            .attr("markerHeight", 6)
            .append("path")
            .attr("d", "M 0,-5 L 10,0 L 0,5")
            .attr("fill", "#ff6b6b");

        // ÂàùÊúüÂåñ
        drawGanttChart();

        function drawGanttChart() {
            // Êó¢Â≠ò„ÅÆË¶ÅÁ¥†„Çí„ÇØ„É™„Ç¢
            g.selectAll("*").remove();

            // „Ç∞„É™„ÉÉ„ÉâÁ∑ö„ÅÆÊèèÁîª
            drawGrid();

            // Ëª∏„ÅÆÊèèÁîª
            drawAxes();

            // ‰ªäÊó•„ÅÆÁ∑ö
            drawTodayLine();

            // „Çø„Çπ„ÇØ„Éê„Éº„ÅÆÊèèÁîª
            drawTaskBars();

            // ‰æùÂ≠òÈñ¢‰øÇ„ÅÆÊèèÁîª
            if (showDependencies) {
                drawDependencies();
            }

            // Áµ±Ë®àÊõ¥Êñ∞
            updateStatistics();
        }

        function drawGrid() {
            // Á∏¶Á∑öÔºàÊôÇÈñìËª∏Ôºâ
            const timeInterval = currentTimeScale === 'day' ? d3.timeDay.every(1) :
                               currentTimeScale === 'week' ? d3.timeWeek.every(1) :
                               d3.timeMonth.every(1);

            g.append("g")
                .attr("class", "grid")
                .selectAll("line")
                .data(xScale.ticks(timeInterval))
                .enter().append("line")
                .attr("x1", d => xScale(d))
                .attr("x2", d => xScale(d))
                .attr("y1", 0)
                .attr("y2", height);

            // Ê®™Á∑öÔºà„Çø„Çπ„ÇØÂå∫Âàá„ÇäÔºâ
            g.append("g")
                .attr("class", "grid")
                .selectAll("line")
                .data(ganttData)
                .enter().append("line")
                .attr("x1", 0)
                .attr("x2", width)
                .attr("y1", d => yScale(d.task) + yScale.bandwidth())
                .attr("y2", d => yScale(d.task) + yScale.bandwidth());
        }

        function drawAxes() {
            // XËª∏ÔºàÊôÇÈñìËª∏Ôºâ
            const timeFormat = currentTimeScale === 'day' ? d3.timeFormat("%m/%d") :
                              currentTimeScale === 'week' ? d3.timeFormat("%m/%d") :
                              d3.timeFormat("%Y/%m");

            const xAxis = d3.axisBottom(xScale)
                .tickFormat(timeFormat);

            g.append("g")
                .attr("class", "axis x-axis")
                .attr("transform", `translate(0,${height})`)
                .call(xAxis)
                .selectAll("text")
                .style("text-anchor", "end")
                .attr("dx", "-.8em")
                .attr("dy", ".15em")
                .attr("transform", "rotate(-45)");

            // YËª∏Ôºà„Çø„Çπ„ÇØËª∏Ôºâ
            const yAxis = d3.axisLeft(yScale);

            g.append("g")
                .attr("class", "axis y-axis")
                .call(yAxis);
        }

        function drawTodayLine() {
            const today = new Date();
            
            g.append("line")
                .attr("class", "today-line")
                .attr("x1", xScale(today))
                .attr("x2", xScale(today))
                .attr("y1", 0)
                .attr("y2", height);

            g.append("text")
                .attr("x", xScale(today))
                .attr("y", -10)
                .attr("text-anchor", "middle")
                .style("font-size", "10px")
                .style("font-weight", "bold")
                .style("fill", "#E91E63")
                .text("‰ªäÊó•");
        }

        function drawTaskBars() {
            const taskGroups = g.selectAll(".task-group")
                .data(ganttData)
                .enter().append("g")
                .attr("class", "task-group");

            // „É°„Ç§„É≥„ÅÆ„Çø„Çπ„ÇØ„Éê„Éº
            taskGroups.append("rect")
                .attr("class", d => `task-bar ${getTaskStatus(d)}`)
                .attr("x", d => xScale(d.startDate))
                .attr("y", d => yScale(d.task))
                .attr("width", d => Math.max(2, xScale(d.endDate) - xScale(d.startDate)))
                .attr("height", yScale.bandwidth())
                .attr("rx", 4)
                .attr("fill", d => getTaskColor(d))
                .attr("stroke", "#666")
                .attr("stroke-width", 1)
                .on("mouseover", showTaskTooltip)
                .on("mouseout", hideTooltip)
                .on("click", selectTask);

            // ÈÄ≤Êçó„Éê„Éº
            taskGroups.append("rect")
                .attr("class", d => `progress-bar ${getTaskStatus(d)}`)
                .attr("x", d => xScale(d.startDate))
                .attr("y", d => yScale(d.task) + 3)
                .attr("width", d => Math.max(0, (xScale(d.endDate) - xScale(d.startDate)) * (d.progress / 100)))
                .attr("height", yScale.bandwidth() - 6)
                .attr("rx", 2)
                .attr("fill", d => d.progress === 100 ? "#2E7D32" : "#1565C0")
                .attr("opacity", 0.8);

            // ÈÄ≤Êçó„ÉÜ„Ç≠„Çπ„Éà
            taskGroups.append("text")
                .attr("class", "progress-text")
                .attr("x", d => xScale(d.startDate) + (xScale(d.endDate) - xScale(d.startDate)) / 2)
                .attr("y", d => yScale(d.task) + yScale.bandwidth() / 2)
                .attr("dy", "0.35em")
                .text(d => `${d.progress}%`);
        }

        function drawDependencies() {
            ganttData.forEach(task => {
                if (task.dependencies) {
                    const deps = task.dependencies.split(';').map(s => s.trim()).filter(s => s);
                    deps.forEach(depName => {
                        const depTask = ganttData.find(t => t.task === depName);
                        if (depTask) {
                            drawDependencyArrow(depTask, task);
                        }
                    });
                }
            });
        }

        function drawDependencyArrow(fromTask, toTask) {
            const fromX = xScale(fromTask.endDate);
            const fromY = yScale(fromTask.task) + yScale.bandwidth() / 2;
            const toX = xScale(toTask.startDate);
            const toY = yScale(toTask.task) + yScale.bandwidth() / 2;

            const path = `M ${fromX} ${fromY} L ${toX} ${toY}`;

            g.append("path")
                .attr("class", "dependency")
                .attr("d", path)
                .on("mouseover", function() {
                    showDependencyTooltip(event, fromTask, toTask);
                })
                .on("mouseout", hideTooltip);
        }

        // „Çø„Çπ„ÇØ„ÅÆÁä∂ÊÖãÂà§ÂÆö
        function getTaskStatus(d) {
            const now = new Date();
            if (d.progress === 100) return "completed";
            if (d.endDate < now && d.progress < 100) return "delayed";
            if (d.startDate <= now && d.endDate >= now) return "in-progress";
            return "not-started";
        }

        // „Çø„Çπ„ÇØ„ÅÆËâ≤Ê±∫ÂÆö
        function getTaskColor(d) {
            const status = getTaskStatus(d);
            const colors = {
                'completed': '#4CAF50',
                'in-progress': '#2196F3', 
                'delayed': '#F44336',
                'not-started': '#FFC107'
            };
            return colors[status] || categoryColors[d.category] || '#9E9E9E';
        }

        // „ÉÑ„Éº„É´„ÉÅ„ÉÉ„ÉóË°®Á§∫
        function showTaskTooltip(event, d) {
            const formatDate = d3.timeFormat("%YÂπ¥%mÊúà%dÊó•");
            const status = getTaskStatus(d);
            const statusText = {
                'completed': '‚úÖ ÂÆå‰∫Ü',
                'in-progress': 'üîÑ ÈÄ≤Ë°å‰∏≠',
                'delayed': '‚ö†Ô∏è ÈÅÖÂª∂',
                'not-started': '‚è≥ Êú™ÈñãÂßã'
            };

            tooltip.style("display", "block")
                .html(`
                    <strong>${d.task}</strong><br>
                    Áä∂ÊÖã: ${statusText[status]}<br>
                    ÈñãÂßã: ${formatDate(d.startDate)}<br>
                    ÁµÇ‰∫Ü: ${formatDate(d.endDate)}<br>
                    ÊúüÈñì: ${Math.ceil(d.duration)}Êó•<br>
                    ÈÄ≤Êçó: ${d.progress}%<br>
                    ÊãÖÂΩìËÄÖ: ${d.resource || "Êú™ÂÆö"}<br>
                    „Ç´„ÉÜ„Ç¥„É™: ${d.category || "‰∏ÄËà¨"}
                `)
                .style("left", (event.pageX + 10) + "px")
                .style("top", (event.pageY - 10) + "px");
        }

        function showDependencyTooltip(event, fromTask, toTask) {
            tooltip.style("display", "block")
                .html(`
                    <strong>üîó ‰æùÂ≠òÈñ¢‰øÇ</strong><br>
                    ${fromTask.task}<br>
                    ‚Üì<br>
                    ${toTask.task}
                `)
                .style("left", (event.pageX + 10) + "px")
                .style("top", (event.pageY - 10) + "px");
        }

        function hideTooltip() {
            tooltip.style("display", "none");
        }

        // „Çø„Çπ„ÇØÈÅ∏Êäû
        function selectTask(event, d) {
            // Êó¢Â≠ò„ÅÆÈÅ∏Êäû„Çí„ÇØ„É™„Ç¢
            g.selectAll(".task-bar").attr("stroke", "#666").attr("stroke-width", 1);
            
            // Êñ∞„Åó„ÅÑÈÅ∏Êäû
            d3.select(this).attr("stroke", "#333").attr("stroke-width", 3);
            selectedTask = d;
        }

        // Áµ±Ë®àÊÉÖÂ†±„ÅÆÊõ¥Êñ∞
        function updateStatistics() {
            const totalTasks = ganttData.length;
            const completedTasks = ganttData.filter(d => d.progress === 100).length;
            const inProgressTasks = ganttData.filter(d => d.progress > 0 && d.progress < 100).length;
            const delayedTasks = ganttData.filter(d => getTaskStatus(d) === 'delayed').length;
            const overallProgress = Math.round(ganttData.reduce((sum, d) => sum + d.progress, 0) / totalTasks);
            
            const projectStart = d3.min(ganttData, d => d.startDate);
            const projectEnd = d3.max(ganttData, d => d.endDate);
            const projectDuration = Math.ceil((projectEnd - projectStart) / (1000 * 60 * 60 * 24));

            document.getElementById('totalTasks').textContent = totalTasks;
            document.getElementById('completedTasks').textContent = completedTasks;
            document.getElementById('inProgressTasks').textContent = inProgressTasks;
            document.getElementById('delayedTasks').textContent = delayedTasks;
            document.getElementById('overallProgress').textContent = overallProgress + "%";
            document.getElementById('projectDuration').textContent = projectDuration + "Êó•";
        }

        // „Ç≥„É≥„Éà„É≠„Éº„É´Èñ¢Êï∞
        function fitToView() {
            // ÂÖ®‰ΩìË°®Á§∫Ê©üËÉΩÔºàÂÆüË£Ö‰∫àÂÆöÔºâ
            console.log("ÂÖ®‰ΩìË°®Á§∫");
        }

        function zoomToToday() {
            const today = new Date();
            // ‰ªäÊó•„ÅÆ‰ΩçÁΩÆ„Å´„Çπ„ÇØ„É≠„Éº„É´ÔºàÂÆüË£Ö‰∫àÂÆöÔºâ
            console.log("‰ªäÊó•„Å∏„Ç∫„Éº„É†");
        }

        function changeTimeScale() {
            currentTimeScale = document.getElementById('timeScale').value;
            const scaleText = {
                'day': 'Êó•Âçò‰Ωç',
                'week': 'ÈÄ±Âçò‰Ωç', 
                'month': 'ÊúàÂçò‰Ωç'
            };
            document.getElementById('currentView').textContent = scaleText[currentTimeScale];
            drawGanttChart();
        }

        function toggleDependencies() {
            showDependencies = !showDependencies;
            document.getElementById('dependencyStatus').textContent = showDependencies ? 'Ë°®Á§∫' : 'ÈùûË°®Á§∫';
            drawGanttChart();
        }

        function showCriticalPath() {
            // „ÇØ„É™„ÉÜ„Ç£„Ç´„É´„Éë„ÇπË°®Á§∫ÔºàÂÆüË£Ö‰∫àÂÆöÔºâ
            alert("üéØ „ÇØ„É™„ÉÜ„Ç£„Ç´„É´„Éë„ÇπÊ©üËÉΩ„ÅØÈñãÁô∫‰∏≠„Åß„Åô");
        }

        function exportChart() {
            const svgData = new XMLSerializer().serializeToString(svg.node());
            const blob = new Blob([svgData], {type: "image/svg+xml"});
            const url = URL.createObjectURL(blob);
            const link = document.createElement("a");
            link.href = url;
            link.download = "gantt-chart.svg";
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        function showStatistics() {
            const stats = ganttData.map(d => ({
                task: d.task,
                status: getTaskStatus(d),
                progress: d.progress,
                duration: d.duration
            }));

            const message = `
üìä Ë©≥Á¥∞Áµ±Ë®àÊÉÖÂ†±:

${stats.map(s => `‚Ä¢ ${s.task}: ${s.progress}% (${s.status})`).join('\\n')}

üéØ „Éó„É≠„Ç∏„Çß„ÇØ„ÉàÊ¶ÇË¶Å:
‚Ä¢ Á∑èÊúüÈñì: ${Math.ceil((d3.max(ganttData, d => d.endDate) - d3.min(ganttData, d => d.startDate)) / (1000 * 60 * 60 * 24))}Êó•
‚Ä¢ Âπ≥ÂùáÈÄ≤Êçó: ${Math.round(d3.mean(ganttData, d => d.progress))}%
            `;
            
            alert(message);
        }

        // „É™„Çµ„Ç§„Ç∫ÂØæÂøú
        window.addEventListener('resize', () => {
            // „É™„Çµ„Ç§„Ç∫Âá¶ÁêÜÔºàÂÆüË£Ö‰∫àÂÆöÔºâ
            console.log("„É™„Çµ„Ç§„Ç∫ÂØæÂøú");
        });

        // ÂàùÊúüË°®Á§∫„É°„ÉÉ„Çª„Éº„Ç∏
        console.log('üìÖ „Ç§„É≥„Çø„É©„ÇØ„ÉÜ„Ç£„Éñ„Ç¨„É≥„Éà„ÉÅ„É£„Éº„Éà„ÅåË™≠„ÅøËæº„Åæ„Çå„Åæ„Åó„Åü');
        console.log('Ê©üËÉΩ: „Çø„Çπ„ÇØÈÅ∏Êäû„ÄÅ‰æùÂ≠òÈñ¢‰øÇË°®Á§∫„ÄÅÊôÇÈñìËª∏Âàá„ÇäÊõø„Åà„ÄÅÈÄ≤ÊçóÁ¢∫Ë™ç');
    </script>
</body>
</html>