<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ã‚¬ãƒ³ãƒˆãƒãƒ£ãƒ¼ãƒˆ - D3-Mind-Flow-Editor</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        * {
            box-sizing: border-box;
        }

        body {
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', 'Hiragino Sans', 'Yu Gothic UI', system-ui, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            overflow: hidden;
        }

        .container {
            width: 100vw;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            padding: 15px 20px;
            border-bottom: 1px solid #e0e0e0;
            backdrop-filter: blur(10px);
        }

        .header h2 {
            margin: 0 0 10px 0;
            color: #333;
            font-size: 18px;
        }

        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            align-items: center;
        }

        .controls button, .controls select {
            padding: 8px 15px;
            border: none;
            border-radius: 6px;
            background: #4CAF50;
            color: white;
            cursor: pointer;
            font-size: 12px;
            font-weight: 500;
            transition: all 0.2s ease;
        }

        .controls button:hover {
            background: #45a049;
            transform: translateY(-1px);
        }

        .controls select {
            background: white;
            color: #333;
            border: 1px solid #ddd;
        }

        .gantt-container {
            flex: 1;
            overflow: auto;
            background: white;
        }

        .gantt-svg {
            border: none;
            background: white;
        }

        .task-bar {
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .task-bar:hover {
            stroke: #333;
            stroke-width: 2;
            filter: brightness(0.9);
        }

        .task-bar.completed {
            fill: #4CAF50;
        }

        .task-bar.in-progress {
            fill: #2196F3;
        }

        .task-bar.delayed {
            fill: #F44336;
        }

        .task-bar.not-started {
            fill: #FFC107;
        }

        .progress-bar {
            pointer-events: none;
            opacity: 0.8;
        }

        .progress-bar.completed {
            fill: #2E7D32;
        }

        .progress-bar.in-progress {
            fill: #1565C0;
        }

        .task-label {
            font-size: 11px;
            font-weight: 500;
            fill: #333;
            pointer-events: none;
        }

        .axis {
            font-size: 10px;
        }

        .axis path,
        .axis line {
            fill: none;
            stroke: #999;
            shape-rendering: crispEdges;
        }

        .axis text {
            font-family: inherit;
        }

        .grid line {
            stroke: #e0e0e0;
            stroke-dasharray: 2,2;
            shape-rendering: crispEdges;
        }

        .dependency {
            fill: none;
            stroke: #ff6b6b;
            stroke-width: 2;
            marker-end: url(#arrowhead);
            opacity: 0.7;
        }

        .dependency:hover {
            opacity: 1;
            stroke-width: 3;
        }

        .tooltip {
            position: absolute;
            padding: 12px;
            background: rgba(0, 0, 0, 0.9);
            color: white;
            border-radius: 6px;
            pointer-events: none;
            font-size: 12px;
            z-index: 1000;
            max-width: 300px;
            backdrop-filter: blur(5px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }

        .stats {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.95);
            padding: 15px;
            border-radius: 10px;
            font-size: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
            backdrop-filter: blur(10px);
            min-width: 220px;
            z-index: 999;
        }

        .stats h4 {
            margin: 0 0 10px 0;
            color: #333;
            font-size: 14px;
        }

        .stats div {
            margin: 5px 0;
            color: #666;
        }

        .legend {
            display: flex;
            gap: 15px;
            margin-top: 10px;
            flex-wrap: wrap;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 11px;
        }

        .legend-color {
            width: 12px;
            height: 12px;
            border-radius: 2px;
        }

        .milestone {
            fill: #FF5722;
            stroke: #BF360C;
            stroke-width: 2;
        }

        .today-line {
            stroke: #E91E63;
            stroke-width: 2;
            stroke-dasharray: 5,5;
        }

        .progress-text {
            font-size: 9px;
            font-weight: bold;
            fill: white;
            text-anchor: middle;
            pointer-events: none;
        }

        /* Responsive design */
        @media (max-width: 768px) {
            .header {
                padding: 10px;
            }
            
            .controls {
                gap: 5px;
            }
            
            .controls button, .controls select {
                padding: 6px 10px;
                font-size: 11px;
            }
            
            .stats {
                bottom: 10px;
                right: 10px;
                left: 10px;
                font-size: 11px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h2>ğŸ“… ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ã‚¬ãƒ³ãƒˆãƒãƒ£ãƒ¼ãƒˆ</h2>
            <div class="controls">
                <button onclick="fitToView()" title="å…¨ä½“ã‚’è¡¨ç¤º">ğŸ¯ å…¨ä½“è¡¨ç¤º</button>
                <button onclick="zoomToToday()" title="ä»Šæ—¥ã®ä½ç½®ã«ã‚ºãƒ¼ãƒ ">ğŸ“ ä»Šæ—¥</button>
                <select id="timeScale" onchange="changeTimeScale()" title="æ™‚é–“è»¸ã®å˜ä½ã‚’é¸æŠ">
                    <option value="day">æ—¥å˜ä½</option>
                    <option value="week" selected>é€±å˜ä½</option>
                    <option value="month">æœˆå˜ä½</option>
                </select>
                <button onclick="toggleDependencies()" title="ä¾å­˜é–¢ä¿‚ã®è¡¨ç¤ºã‚’åˆ‡ã‚Šæ›¿ãˆ">ğŸ”— ä¾å­˜é–¢ä¿‚</button>
                <button onclick="showCriticalPath()" title="ã‚¯ãƒªãƒ†ã‚£ã‚«ãƒ«ãƒ‘ã‚¹ã‚’ãƒã‚¤ãƒ©ã‚¤ãƒˆ">âš¡ ã‚¯ãƒªãƒ†ã‚£ã‚«ãƒ«</button>
                <button onclick="exportChart()" title="SVGã¨ã—ã¦ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰">ğŸ’¾ SVGå‡ºåŠ›</button>
                <button onclick="showStatistics()" title="è©³ç´°çµ±è¨ˆã‚’è¡¨ç¤º">ğŸ“Š çµ±è¨ˆè©³ç´°</button>
            </div>
            
            <div class="legend">
                <div class="legend-item">
                    <div class="legend-color" style="background: #4CAF50;"></div>
                    <span>å®Œäº†æ¸ˆã¿</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #2196F3;"></div>
                    <span>é€²è¡Œä¸­</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #FFC107;"></div>
                    <span>æœªé–‹å§‹</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #F44336;"></div>
                    <span>é…å»¶</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #FF5722;"></div>
                    <span>ãƒã‚¤ãƒ«ã‚¹ãƒˆãƒ¼ãƒ³</span>
                </div>
            </div>
        </div>

        <div class="gantt-container">
            <svg class="gantt-svg" id="gantt"></svg>
        </div>

        <div class="stats">
            <h4>ğŸ“Š ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆçµ±è¨ˆ</h4>
            <div>ç·ã‚¿ã‚¹ã‚¯æ•°: <span id="totalTasks">0</span></div>
            <div>å®Œäº†ã‚¿ã‚¹ã‚¯: <span id="completedTasks">0</span></div>
            <div>é€²è¡Œä¸­ã‚¿ã‚¹ã‚¯: <span id="inProgressTasks">0</span></div>
            <div>é…å»¶ã‚¿ã‚¹ã‚¯: <span id="delayedTasks">0</span></div>
            <div>å…¨ä½“é€²æ—: <span id="overallProgress">0%</span></div>
            <div>ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæœŸé–“: <span id="projectDuration">0æ—¥</span></div>
            <div>ç¾åœ¨ã®è¡¨ç¤º: <span id="currentView">é€±å˜ä½</span></div>
            <div>ä¾å­˜é–¢ä¿‚: <span id="dependencyStatus">è¡¨ç¤º</span></div>
        </div>

        <div class="tooltip" id="tooltip" style="display: none;"></div>
    </div>

    <script>
        // ãƒ‡ãƒ¼ã‚¿ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ï¼ˆå®Ÿéš›ã®ãƒ‡ãƒ¼ã‚¿ã«ç½®ãæ›ãˆã‚‰ã‚Œã¾ã™ï¼‰
        let ganttData = {{DIAGRAM_DATA}};
        
        // ãƒ‡ãƒ¼ã‚¿ãŒç„¡ã„å ´åˆã®ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿
        if (!ganttData || !ganttData.content) {
            const today = new Date();
            const formatDate = d => d.toISOString().split('T')[0];
            
            ganttData = [
                {
                    task: "ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆè¨ˆç”»",
                    start: formatDate(new Date(today.getTime() - 14 * 24 * 60 * 60 * 1000)),
                    end: formatDate(new Date(today.getTime() - 7 * 24 * 60 * 60 * 1000)),
                    progress: 100,
                    category: "è¨ˆç”»",
                    resource: "ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼",
                    dependencies: ""
                },
                {
                    task: "è¦ä»¶å®šç¾©",
                    start: formatDate(new Date(today.getTime() - 6 * 24 * 60 * 60 * 1000)),
                    end: formatDate(new Date(today.getTime() + 7 * 24 * 60 * 60 * 1000)),
                    progress: 80,
                    category: "åˆ†æ",
                    resource: "ãƒ“ã‚¸ãƒã‚¹ã‚¢ãƒŠãƒªã‚¹ãƒˆ",
                    dependencies: "ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆè¨ˆç”»"
                },
                {
                    task: "ã‚·ã‚¹ãƒ†ãƒ è¨­è¨ˆ",
                    start: formatDate(new Date(today.getTime() + 8 * 24 * 60 * 60 * 1000)),
                    end: formatDate(new Date(today.getTime() + 21 * 24 * 60 * 60 * 1000)),
                    progress: 30,
                    category: "è¨­è¨ˆ",
                    resource: "ã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒˆ",
                    dependencies: "è¦ä»¶å®šç¾©"
                },
                {
                    task: "é–‹ç™ºãƒ•ã‚§ãƒ¼ã‚º1",
                    start: formatDate(new Date(today.getTime() + 22 * 24 * 60 * 60 * 1000)),
                    end: formatDate(new Date(today.getTime() + 50 * 24 * 60 * 60 * 1000)),
                    progress: 0,
                    category: "é–‹ç™º",
                    resource: "é–‹ç™ºãƒãƒ¼ãƒ ",
                    dependencies: "ã‚·ã‚¹ãƒ†ãƒ è¨­è¨ˆ"
                },
                {
                    task: "ãƒ†ã‚¹ãƒˆãƒ•ã‚§ãƒ¼ã‚º",
                    start: formatDate(new Date(today.getTime() + 45 * 24 * 60 * 60 * 1000)),
                    end: formatDate(new Date(today.getTime() + 65 * 24 * 60 * 60 * 1000)),
                    progress: 0,
                    category: "ãƒ†ã‚¹ãƒˆ",
                    resource: "QAãƒãƒ¼ãƒ ",
                    dependencies: "é–‹ç™ºãƒ•ã‚§ãƒ¼ã‚º1"
                }
            ];
        }

        // è¨­å®šã¨ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°
        const margin = {top: 50, right: 50, bottom: 80, left: 200};
        const containerWidth = Math.max(1200, window.innerWidth - 40);
        const containerHeight = Math.max(600, Math.max(400, ganttData.length * 60 + 200));
        const width = containerWidth - margin.left - margin.right;
        const height = containerHeight - margin.top - margin.bottom;

        let currentTimeScale = 'week';
        let showDependencies = true;
        let selectedTask = null;

        // SVGä½œæˆ
        const svg = d3.select("#gantt")
            .attr("width", containerWidth)
            .attr("height", containerHeight);

        // ãƒ¡ã‚¤ãƒ³ã‚°ãƒ«ãƒ¼ãƒ—
        const g = svg.append("g")
            .attr("transform", `translate(${margin.left},${margin.top})`);

        // ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—
        const tooltip = d3.select("#tooltip");

        // ãƒ‡ãƒ¼ã‚¿å‡¦ç†
        ganttData.forEach(d => {
            d.startDate = new Date(d.start);
            d.endDate = new Date(d.end);
            d.duration = (d.endDate - d.startDate) / (1000 * 60 * 60 * 24);
            d.progress = parseFloat(d.progress) || 0;
        });

        // ã‚¹ã‚±ãƒ¼ãƒ«è¨­å®š
        const timeExtent = d3.extent(ganttData.flatMap(d => [d.startDate, d.endDate]));
        const xScale = d3.scaleTime()
            .domain(timeExtent)
            .range([0, width]);

        const yScale = d3.scaleBand()
            .domain(ganttData.map(d => d.task))
            .range([0, height])
            .padding(0.2);

        // ã‚«ãƒ†ã‚´ãƒªè‰²ãƒãƒƒãƒ”ãƒ³ã‚°
        const categoryColors = {
            'è¨ˆç”»': '#9C27B0',
            'åˆ†æ': '#2196F3', 
            'è¨­è¨ˆ': '#FF9800',
            'é–‹ç™º': '#4CAF50',
            'ãƒ†ã‚¹ãƒˆ': '#F44336',
            'ãƒ‡ãƒ—ãƒ­ã‚¤': '#00BCD4'
        };

        // çŸ¢å°ãƒãƒ¼ã‚«ãƒ¼å®šç¾©
        svg.append("defs").append("marker")
            .attr("id", "arrowhead")
            .attr("viewBox", "-0 -5 10 10")
            .attr("refX", 8)
            .attr("refY", 0)
            .attr("orient", "auto")
            .attr("markerWidth", 6)
            .attr("markerHeight", 6)
            .append("path")
            .attr("d", "M 0,-5 L 10,0 L 0,5")
            .attr("fill", "#ff6b6b");

        // åˆæœŸåŒ–
        drawGanttChart();

        function drawGanttChart() {
            // æ—¢å­˜ã®è¦ç´ ã‚’ã‚¯ãƒªã‚¢
            g.selectAll("*").remove();

            // ã‚°ãƒªãƒƒãƒ‰ç·šã®æç”»
            drawGrid();

            // è»¸ã®æç”»
            drawAxes();

            // ä»Šæ—¥ã®ç·š
            drawTodayLine();

            // ã‚¿ã‚¹ã‚¯ãƒãƒ¼ã®æç”»
            drawTaskBars();

            // ä¾å­˜é–¢ä¿‚ã®æç”»
            if (showDependencies) {
                drawDependencies();
            }

            // çµ±è¨ˆæ›´æ–°
            updateStatistics();
        }

        function drawGrid() {
            // ç¸¦ç·šï¼ˆæ™‚é–“è»¸ï¼‰
            const timeInterval = currentTimeScale === 'day' ? d3.timeDay.every(1) :
                               currentTimeScale === 'week' ? d3.timeWeek.every(1) :
                               d3.timeMonth.every(1);

            g.append("g")
                .attr("class", "grid")
                .selectAll("line")
                .data(xScale.ticks(timeInterval))
                .enter().append("line")
                .attr("x1", d => xScale(d))
                .attr("x2", d => xScale(d))
                .attr("y1", 0)
                .attr("y2", height);

            // æ¨ªç·šï¼ˆã‚¿ã‚¹ã‚¯åŒºåˆ‡ã‚Šï¼‰
            g.append("g")
                .attr("class", "grid")
                .selectAll("line")
                .data(ganttData)
                .enter().append("line")
                .attr("x1", 0)
                .attr("x2", width)
                .attr("y1", d => yScale(d.task) + yScale.bandwidth())
                .attr("y2", d => yScale(d.task) + yScale.bandwidth());
        }

        function drawAxes() {
            // Xè»¸ï¼ˆæ™‚é–“è»¸ï¼‰
            const timeFormat = currentTimeScale === 'day' ? d3.timeFormat("%m/%d") :
                              currentTimeScale === 'week' ? d3.timeFormat("%m/%d") :
                              d3.timeFormat("%Y/%m");

            const xAxis = d3.axisBottom(xScale)
                .tickFormat(timeFormat);

            g.append("g")
                .attr("class", "axis x-axis")
                .attr("transform", `translate(0,${height})`)
                .call(xAxis)
                .selectAll("text")
                .style("text-anchor", "end")
                .attr("dx", "-.8em")
                .attr("dy", ".15em")
                .attr("transform", "rotate(-45)");

            // Yè»¸ï¼ˆã‚¿ã‚¹ã‚¯è»¸ï¼‰
            const yAxis = d3.axisLeft(yScale);

            g.append("g")
                .attr("class", "axis y-axis")
                .call(yAxis);
        }

        function drawTodayLine() {
            const today = new Date();
            
            g.append("line")
                .attr("class", "today-line")
                .attr("x1", xScale(today))
                .attr("x2", xScale(today))
                .attr("y1", 0)
                .attr("y2", height);

            g.append("text")
                .attr("x", xScale(today))
                .attr("y", -10)
                .attr("text-anchor", "middle")
                .style("font-size", "10px")
                .style("font-weight", "bold")
                .style("fill", "#E91E63")
                .text("ä»Šæ—¥");
        }

        function drawTaskBars() {
            const taskGroups = g.selectAll(".task-group")
                .data(ganttData)
                .enter().append("g")
                .attr("class", "task-group");

            // ãƒ¡ã‚¤ãƒ³ã®ã‚¿ã‚¹ã‚¯ãƒãƒ¼
            taskGroups.append("rect")
                .attr("class", d => `task-bar ${getTaskStatus(d)}`)
                .attr("x", d => xScale(d.startDate))
                .attr("y", d => yScale(d.task))
                .attr("width", d => Math.max(2, xScale(d.endDate) - xScale(d.startDate)))
                .attr("height", yScale.bandwidth())
                .attr("rx", 4)
                .attr("fill", d => getTaskColor(d))
                .attr("stroke", "#666")
                .attr("stroke-width", 1)
                .on("mouseover", showTaskTooltip)
                .on("mouseout", hideTooltip)
                .on("click", selectTask);

            // é€²æ—ãƒãƒ¼
            taskGroups.append("rect")
                .attr("class", d => `progress-bar ${getTaskStatus(d)}`)
                .attr("x", d => xScale(d.startDate))
                .attr("y", d => yScale(d.task) + 3)
                .attr("width", d => Math.max(0, (xScale(d.endDate) - xScale(d.startDate)) * (d.progress / 100)))
                .attr("height", yScale.bandwidth() - 6)
                .attr("rx", 2)
                .attr("fill", d => d.progress === 100 ? "#2E7D32" : "#1565C0")
                .attr("opacity", 0.8);

            // é€²æ—ãƒ†ã‚­ã‚¹ãƒˆ
            taskGroups.append("text")
                .attr("class", "progress-text")
                .attr("x", d => xScale(d.startDate) + (xScale(d.endDate) - xScale(d.startDate)) / 2)
                .attr("y", d => yScale(d.task) + yScale.bandwidth() / 2)
                .attr("dy", "0.35em")
                .text(d => `${d.progress}%`);
        }

        function drawDependencies() {
            ganttData.forEach(task => {
                if (task.dependencies) {
                    const deps = task.dependencies.split(';').map(s => s.trim()).filter(s => s);
                    deps.forEach(depName => {
                        const depTask = ganttData.find(t => t.task === depName);
                        if (depTask) {
                            drawDependencyArrow(depTask, task);
                        }
                    });
                }
            });
        }

        function drawDependencyArrow(fromTask, toTask) {
            const fromX = xScale(fromTask.endDate);
            const fromY = yScale(fromTask.task) + yScale.bandwidth() / 2;
            const toX = xScale(toTask.startDate);
            const toY = yScale(toTask.task) + yScale.bandwidth() / 2;

            const path = `M ${fromX} ${fromY} L ${toX} ${toY}`;

            g.append("path")
                .attr("class", "dependency")
                .attr("d", path)
                .on("mouseover", function() {
                    showDependencyTooltip(event, fromTask, toTask);
                })
                .on("mouseout", hideTooltip);
        }

        // ã‚¿ã‚¹ã‚¯ã®çŠ¶æ…‹åˆ¤å®š
        function getTaskStatus(d) {
            const now = new Date();
            if (d.progress === 100) return "completed";
            if (d.endDate < now && d.progress < 100) return "delayed";
            if (d.startDate <= now && d.endDate >= now) return "in-progress";
            return "not-started";
        }

        // ã‚¿ã‚¹ã‚¯ã®è‰²æ±ºå®š
        function getTaskColor(d) {
            const status = getTaskStatus(d);
            const colors = {
                'completed': '#4CAF50',
                'in-progress': '#2196F3', 
                'delayed': '#F44336',
                'not-started': '#FFC107'
            };
            return colors[status] || categoryColors[d.category] || '#9E9E9E';
        }

        // ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—è¡¨ç¤º
        function showTaskTooltip(event, d) {
            const formatDate = d3.timeFormat("%Yå¹´%mæœˆ%dæ—¥");
            const status = getTaskStatus(d);
            const statusText = {
                'completed': 'âœ… å®Œäº†',
                'in-progress': 'ğŸ”„ é€²è¡Œä¸­',
                'delayed': 'âš ï¸ é…å»¶',
                'not-started': 'â³ æœªé–‹å§‹'
            };

            tooltip.style("display", "block")
                .html(`
                    <strong>${d.task}</strong><br>
                    çŠ¶æ…‹: ${statusText[status]}<br>
                    é–‹å§‹: ${formatDate(d.startDate)}<br>
                    çµ‚äº†: ${formatDate(d.endDate)}<br>
                    æœŸé–“: ${Math.ceil(d.duration)}æ—¥<br>
                    é€²æ—: ${d.progress}%<br>
                    æ‹…å½“è€…: ${d.resource || "æœªå®š"}<br>
                    ã‚«ãƒ†ã‚´ãƒª: ${d.category || "ä¸€èˆ¬"}
                `)
                .style("left", (event.pageX + 10) + "px")
                .style("top", (event.pageY - 10) + "px");
        }

        function showDependencyTooltip(event, fromTask, toTask) {
            tooltip.style("display", "block")
                .html(`
                    <strong>ğŸ”— ä¾å­˜é–¢ä¿‚</strong><br>
                    ${fromTask.task}<br>
                    â†“<br>
                    ${toTask.task}
                `)
                .style("left", (event.pageX + 10) + "px")
                .style("top", (event.pageY - 10) + "px");
        }

        function hideTooltip() {
            tooltip.style("display", "none");
        }

        // ã‚¿ã‚¹ã‚¯é¸æŠ
        function selectTask(event, d) {
            // æ—¢å­˜ã®é¸æŠã‚’ã‚¯ãƒªã‚¢
            g.selectAll(".task-bar").attr("stroke", "#666").attr("stroke-width", 1);
            
            // æ–°ã—ã„é¸æŠ
            d3.select(this).attr("stroke", "#333").attr("stroke-width", 3);
            selectedTask = d;
        }

        // çµ±è¨ˆæƒ…å ±ã®æ›´æ–°
        function updateStatistics() {
            const totalTasks = ganttData.length;
            const completedTasks = ganttData.filter(d => d.progress === 100).length;
            const inProgressTasks = ganttData.filter(d => d.progress > 0 && d.progress < 100).length;
            const delayedTasks = ganttData.filter(d => getTaskStatus(d) === 'delayed').length;
            const overallProgress = Math.round(ganttData.reduce((sum, d) => sum + d.progress, 0) / totalTasks);
            
            const projectStart = d3.min(ganttData, d => d.startDate);
            const projectEnd = d3.max(ganttData, d => d.endDate);
            const projectDuration = Math.ceil((projectEnd - projectStart) / (1000 * 60 * 60 * 24));

            document.getElementById('totalTasks').textContent = totalTasks;
            document.getElementById('completedTasks').textContent = completedTasks;
            document.getElementById('inProgressTasks').textContent = inProgressTasks;
            document.getElementById('delayedTasks').textContent = delayedTasks;
            document.getElementById('overallProgress').textContent = overallProgress + "%";
            document.getElementById('projectDuration').textContent = projectDuration + "æ—¥";
        }

        // ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«é–¢æ•°
        function fitToView() {
            // å…¨ä½“è¡¨ç¤ºæ©Ÿèƒ½ï¼ˆå®Ÿè£…äºˆå®šï¼‰
            console.log("å…¨ä½“è¡¨ç¤º");
        }

        function zoomToToday() {
            const today = new Date();
            // ä»Šæ—¥ã®ä½ç½®ã«ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ï¼ˆå®Ÿè£…äºˆå®šï¼‰
            console.log("ä»Šæ—¥ã¸ã‚ºãƒ¼ãƒ ");
        }

        function changeTimeScale() {
            currentTimeScale = document.getElementById('timeScale').value;
            const scaleText = {
                'day': 'æ—¥å˜ä½',
                'week': 'é€±å˜ä½', 
                'month': 'æœˆå˜ä½'
            };
            document.getElementById('currentView').textContent = scaleText[currentTimeScale];
            drawGanttChart();
        }

        function toggleDependencies() {
            showDependencies = !showDependencies;
            document.getElementById('dependencyStatus').textContent = showDependencies ? 'è¡¨ç¤º' : 'éè¡¨ç¤º';
            drawGanttChart();
        }

        function showCriticalPath() {
            // ã‚¯ãƒªãƒ†ã‚£ã‚«ãƒ«ãƒ‘ã‚¹è¡¨ç¤ºï¼ˆå®Ÿè£…äºˆå®šï¼‰
            alert("ğŸ¯ ã‚¯ãƒªãƒ†ã‚£ã‚«ãƒ«ãƒ‘ã‚¹æ©Ÿèƒ½ã¯é–‹ç™ºä¸­ã§ã™");
        }

        function exportChart() {
            const svgData = new XMLSerializer().serializeToString(svg.node());
            const blob = new Blob([svgData], {type: "image/svg+xml"});
            const url = URL.createObjectURL(blob);
            const link = document.createElement("a");
            link.href = url;
            link.download = "gantt-chart.svg";
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        function showStatistics() {
            const stats = ganttData.map(d => ({
                task: d.task,
                status: getTaskStatus(d),
                progress: d.progress,
                duration: d.duration
            }));

            const message = `
ğŸ“Š è©³ç´°çµ±è¨ˆæƒ…å ±:

${stats.map(s => `â€¢ ${s.task}: ${s.progress}% (${s.status})`).join('\\n')}

ğŸ¯ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦:
â€¢ ç·æœŸé–“: ${Math.ceil((d3.max(ganttData, d => d.endDate) - d3.min(ganttData, d => d.startDate)) / (1000 * 60 * 60 * 24))}æ—¥
â€¢ å¹³å‡é€²æ—: ${Math.round(d3.mean(ganttData, d => d.progress))}%
            `;
            
            alert(message);
        }

        // ãƒªã‚µã‚¤ã‚ºå¯¾å¿œ
        window.addEventListener('resize', () => {
            // ãƒªã‚µã‚¤ã‚ºå‡¦ç†ï¼ˆå®Ÿè£…äºˆå®šï¼‰
            console.log("ãƒªã‚µã‚¤ã‚ºå¯¾å¿œ");
        });

        // åˆæœŸè¡¨ç¤ºãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
        console.log('ğŸ“… ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ã‚¬ãƒ³ãƒˆãƒãƒ£ãƒ¼ãƒˆãŒèª­ã¿è¾¼ã¾ã‚Œã¾ã—ãŸ');
        console.log('æ©Ÿèƒ½: ã‚¿ã‚¹ã‚¯é¸æŠã€ä¾å­˜é–¢ä¿‚è¡¨ç¤ºã€æ™‚é–“è»¸åˆ‡ã‚Šæ›¿ãˆã€é€²æ—ç¢ºèª');
    </script>
</body>
</html>